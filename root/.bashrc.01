## OS UPDATE/UPGRADE, SWAPFILE, HOSTNAME + TIMEZONE + LOCALES SETTINGS && DELETE HISTORY ##

{
source ${HOME}/.scripts/lib.sh

if [ $(tty) == /dev/tty1 ]; then
	## Update Debian source files ##
		backup /etc/apt/sources.list
		curl -o /etc/apt/sources.list ${CBURL}/etc/apt/sources.${OSDIST}.list
		apt-get update
		if [ $? != 0 ]; then echo "update failed..."; exit; fi

	## Unattended Debian update/upgrade ##
		backup /etc/apt/listchanges.conf
		curl -o /etc/apt/listchanges.conf ${CBURL}/etc/apt/listchanges.conf
		apt-get -y dist-upgrade
		if [ $? != 0 ]; then echo "upgrade failed..."; exit; fi
		apt-get -y autoremove

	## Configure swapfile ##
		touch /swapfile
		chmod 600 /swapfile
		dd if=/dev/zero of=/swapfile bs=1024k count=2048
		mkswap /swapfile
		swapon /swapfile
		backup /etc/fstab
		echo "/swapfile none swap sw 0 0" >> /etc/fstab
		sysctl -w vm.swappiness=30

	## SSH port settings ##
		curl -o /etc/ssh/sshd_config ${CBURL}/etc/ssh/sshd_config
		sed -i 's|{{port}}|'${SSHPORT}'|g' /etc/ssh/sshd_config

	## Set hostname, timezone && locale ##
		echo -e ${HNAME} > /etc/hostname
		echo ${TZONE} > /etc/timezone
		rm /etc/localtime
		ln -s /usr/share/zoneinfo/${LTIME} /etc/localtime
		curl -o /etc/default/locale ${CBURL}/etc/default/locale

	## Delete bash history && load new script ##
		cat /dev/null > ${HOME}/.bash_history && history -c
		curl -o ${HOME}/.bashrc ${CBURL}/root/.bashrc.02
    
	## REBOOT ##
		# reboot
fi
exit
}
