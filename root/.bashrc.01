## OS UPDATE/UPGRADE, SWAPFILE, HOSTNAME + TIMEZONE + LOCALES SETTINGS && DELETE HISTORY ##

{
if [ $(tty) == /dev/tty1 ]; then
	## Update Debian source files ##
		curl -o /etc/apt/sources.list ${CBURL}/etc/apt/sources.${OSDIST}.list
		apt-get update || echo "Update failed" && exit
		if [ $? != 0 ]; then exit; fi

	## Unattended Debian update/upgrade ##
		curl -o /etc/apt/listchanges.conf ${CBURL}/etc/apt/listchanges.conf
		PRESEED=${HOME}'/preseed.cfg'
		apt-get -y install debconf-utils
		curl -o ${PRESEED} ${CBURL}/root/preseed.cfg
		debconf-set-selections --verbose < ${PRESEED}
		rm ${PRESEED}
		apt-get -o Dpkg::Options::="--force-confnew" -y dist-upgrade
		if [ $? != 0 ]; then exit; fi
		apt-get -y autoremove

	## Configure swapfile ##
		touch /swapfile
		chmod 600 /swapfile
		dd if=/dev/zero of=/swapfile bs=1024k count=2048
		mkswap /swapfile
		swapon /swapfile
		echo "/swapfile none swap sw 0 0" >> /etc/fstab
		sysctl -w vm.swappiness=30

	## SSH port settings ##
		curl -o /etc/ssh/sshd_config ${CBURL}/etc/ssh/sshd_config
		sed -i 's|{{port}}|'${SSHPORT}'|g' /etc/ssh/sshd_config

	## Set hostname, timezone && locale ##
		echo -e ${HNAME} > /etc/hostname
		echo ${TZONE} > /etc/timezone
		rm /etc/localtime
		ln -s /usr/share/zoneinfo/${LTIME} /etc/localtime
		curl -o /etc/default/locale ${CBURL}/etc/default/locale

	## Delete bash history && load new script ##
		cat /dev/null > ${HOME}/.bash_history && history -c
		curl -o ${HOME}/.bashrc ${CBURL}/root/.bashrc.02
    
	## REBOOT ##
		reboot
fi
exit
}
